"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const yaml = require("js-yaml");
const types_1 = require("./types");
function parse(contents, stage) {
    let document = yaml.safeLoad(contents);
    if (stage) {
        document = document[stage];
        if (!document) {
            throw new Error(`Could not locate stage ${stage} in file env.yml`);
        }
    }
    const result = new types_1.InputDocument();
    const keys = Object.keys(document);
    for (const key of keys) {
        const value = document[key];
        if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {
            result[key] = { value: value };
        }
        else if (value.optional && typeof value.value !== 'undefined') {
            result[key] = {
                value: value.value,
                optional: value.optional,
            };
        }
        else {
            throw new Error(`Parse error reading document.  Invalid value: ${JSON.stringify(value)}`);
        }
    }
    return result;
}
exports.parse = parse;
//# sourceMappingURL=inputParser.js.map